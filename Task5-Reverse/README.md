# iasher_invasion | medium | reverse

## Информация

> Уважаемый сотрудник НИИ Русь-матушка. Только Вы сможете помочь избавить славных русов от напасти ящеров, дабы спасти землю родную

## Выдать участинкам

Архив из директории [public/](public/)

## Описание

Необходимо расшифровать инструкцию, чтобы понять, что пароль от архива в её метаданных. В архиве лежит виртуалка, результат её работы, использованный код и js-скрипт для шифрования программы. Необходимо разобраться в бинаре, какой команде соответствует какой опкод, расшифровать код, разобраться с программой и с помощью этого из output.txt получить флаг.

## Решение

В служебной инструкции ничего интересного, переходим к инструкции к оружию. Там что-то непонятное. С помощью внимательного анализа поймём, что она зашифрована шифром Цезаря. С помощью сайта или вручную поймём, что сдвиг = 6, и расшифруем инструкцию. В ней сказано, что пароль можно получить используя метаспособности. На какое слово похоже "метаспособности"? Конечно же на метаданные. Посмотрим метаданные инструкции к оружию с помощью любого сервиса и поймём, что пароль - 52525252. Распакуем архив. Посмотрим prog2.txt. Первые слова в каждой строчке - скорей всего опкоды. Теперь надо их заменить на числа. Откроем js-скрипт. Очевидно, что он обфусцирован с помощью eval. Воспользуемся онлайн-сервисом или любым другим инструментом и деобфусцируем его. Заменим слова в коде на числа. Переходим к анализу бинаря виртуалки. Внимательно изучив код, мы понимаем, что программа считывает флаг и исполняет команды в зависимости от их опкодов. Перейдя в функцию, исполняющую команду в зависимости от опкода, увидим switch-case. Разбёрся, что деляет каждая функция: 50 - переместить в регистр из памяти, 51 - переместить в память из регистра, 53 - вывести полученную строку на экран, 54 - прибавить к регистру какое-то значение, 55 - вычесть из регистра какое-то значение, 56 - XOR регистра и какого-то значения. Внимательно проанализировав prog2.txt понимаем, что к каждому символу прибавляется его номер, потом вычитается 45 и ксорится с 42. Напишем обратный скрипт, добавив в него результат работы программы, и получим флаг.

[Скрипт](solve/solve.py)

## Флаг

`letoctf{v1rtual_mach1ne_1s_a_c00l_th1ng_f0r_ctf}`

